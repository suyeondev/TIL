# 05. 데이터 가공

## 데이터 분석의 기초, 연산자

### 산술연산자

|    산술연산자    |  기능  |
| :--------------: | :----: |
|      **+**       | 더하기 |
|      **-**       |  빼기  |
|      *****       | 곱하기 |
|      **/**       | 나누기 |
|     **%/%**      |   몫   |
|      **%%**      | 나머지 |
| **\**  또는  ^** |  제곱  |

### 비교 연산자

- 다양한 데이터를 서로 비교하여 TRUE 또는 FALSE와 같은 진리 값을 반환할 때 사용한다.

| 비교연산자 |         기능         |
| :--------: | :------------------: |
|   **>**    |    크다 ( 초과 )     |
|   **>=**   | 크거나 같다 ( 이상 ) |
|   **<**    |    작다 ( 미만 )     |
|   **<=**   | 작거나 같다 ( 이하 ) |
|   **==**   |         같다         |
|   **!=**   |      같지 않다       |



### 논리연산자  (= 불연산자 Boolean Operator)(TRUE, FALSE, T, F)

- 비교연산자를 통해 얻은 진리값을 다시 연산할 때 사용한다. 

| **논리연산자** |    **기능**    |
| :------------: | :------------: |
|     **&**      | 그리고 ( and ) |
|     **\|**     |  또는 ( or )   |



## 분석을 위한 데이터 기본 정리

### 데이터 파악 함수 사용하기

| 데이터 파악 함수 |    활용 예시     |                         설명                         |
| :--------------: | :--------------: | :--------------------------------------------------: |
|    **View()**    | View(데이터세트) |       View 창을 통해 데이터 세트의 데이터 확인       |
|    **str()**     | str(데이터세트)  |  데이터 세트에 있는 변수의 속성과 데이터 형태 확인   |
|    **dim()**     | dim(데이터세트)  | 데이터 세트의 행과 열을 확인하여 데이터 프레임 확인  |
|     **ls()**     |  ls(데이터세트)  | 데이터세트의 변수 항목을 리스트로 만듦 (변수명 확인) |



### 변수명 변경하기

- rename() :  변수 명을 변경해주는 함수!

  - **rename(데이터 세트, 새 변수명 = 기존 변수명)**
  - 새 변수명과 기존 변수명 위치 혼동하지 않기!!! 
  - rename 함수만 실행하고 데이터세트에 <- 으로 반영해주지 않으면, 데이터세트에 결과 적용X

  

### 파생변수 생성하기

- 파생 변수 생성: 보유한 데이터를 기반으로 연산 작업 등을 이용해 새로운 결과를 얻고, 그 결과로 새로운 변수를 생성하는 것.

- 변수의 특징에 따라 다양한 시각으로 분석할 수 있도록 추가로 생성하는 변수! 

  - 데이터 연산방식

    - 기존 데이터 세트에 있는 변수간 연산으로 새로운 변수를 도출할 때 사용.

      ```R
      exdata$x1<- exdata$x2 + exdata$x3 # exdata 데이터 세트에서 x2와 x3를 더해서 exdata데이터세트의 x1변수로 추가.
      ```

  - 변수 변환 방식

    - 기존 데이터를 기준으로 조건에 따라 새로운 값을 부여하여 새로운 변수를 생성.

    - **ifelse( 조건절, 참일 때 값, 거짓일 때 값 )**

      ```R
      # exdata 데이터 세트에서 age 변수 값이 50 이상이면 "Y" 50 미만이면 "N"값으로 exdata 데이터 세트에 age50_YN 변수 생성
      exdata$age50_YN <- ifelse(exdata$age >= 50, "Y", "N") 
      ```

      

## 데이터 추출부터 정제까지, 데이터 전처리

#### 데이터 전처리 과정에 필요한 dplyr 패키지 설치

```R
install.packages("dplyr") # dplyr 패키지 설치
library(dplyr) # dplyr 패키지 로드
```



#### 필요한 데이터 추출하기

|     함수     |              설명               |
| :----------: | :-----------------------------: |
| **select()** | 원하는 데이터의 변수 ( 열) 선택 |
| **filter()** |       조건에 맞는 행 추출       |



- **select 함수**

  - **select ( 데이터세트, 변수명)**  
  - 주로 특정 열을 선택한다고 이해하면 쉽다!
  - 데이터세트 - dataframe 또는 tibble 형식
  - **%>%** 연산자 : 파이프 연산자 라고 하며, dplyr 패키지에 포함된 기능중 하나. 
    - 여러번 실행해야 하는 복잡한 코드를 한번에 처리할 수 있게 연결해주는 연산자.

  ```R
  # 선택한 변수 추출하기
  select(exdata,ID) # exdata에서 ID변수만 추출.
  select(exdata,(ID:AGE)) # : 를 사용해서 연속되는 열을 추출 가능.
  
  # %>% 연산자 사용시,
  exdata %>%
  	select(ID) # %>%로 연결되어 있어 select 함수 안에 데이터세트 명시 안해줘도 된다.
  
  # 선택한 변수만 제외하고 추출하기
  exdata %>%
  	select(-ID,-AGE) # exdata 데이터 세트에서 ID,AGE 변수를 제외하고 추출
  ```

  

- **filter 함수**

  - **filter( 조건절 )**

  - 필요한 조건을 지정하여 조건에 맞는 데이터만 추출하여 분석할 때 활용.

  - 조건절의 데이터가 문자형(chr)일 때는 작은따옴표(' ') 또는 큰따옴표(" ")를 반드시 붙여야 한다. 

  - 숫자형일 때는 따옴표 생략!

    ```R
    # exdata 데이터 세트에서 AREA(지역)가 서울이고, AGE(나이)가 50 이상인 경우만 추출.
    exdata %>%
    	filter(AREA == '서울' & AGE >= 50) # & 연산자를 사용하여 앞뒤 조건이 모두 만족할 때만 추출. 
    ```

    

#### 데이터 정렬하기

| 데이터 정렬 방식 |    정렬 함수    |              설명               |
| :--------------: | :-------------: | :-----------------------------: |
|     오름차순     |    arrange()    | 지정한 변수를 오름차순으로 정렬 |
|     내림차순     | arrange(desc()) | 지정한 변수를 내림차순으로 정렬 |

- **arrange 함수**

  - **arrange(데이터, 기준열1,기준열2, ... )**

  - 기본값이 오름차순 정렬이므로 정렬하려는 변수가 숫자형이면 MISSING(NA) , 음수, 0 , 양수 순으로 정렬.

  - 문자형이면 빈칸부터 !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]_…순으로 정렬된다.

    ```R
    # exdata 데이터 세트의 AGE, ID변수를 오름차순 정렬
    exdata %>%
    	arrange(AGE,ID)
    
    # exdata 데이터 세트의 AMT 변수를 기준으로 내림차순 정렬
    exdata %>%
    	arrange(desc(AMT))
    
    # 변수 중첩 정렬하기 - exdata 데이터세트의 AGE 변수는 오름차순, ID 변수는 내름차순 정렬
    exdata %>%
    	arrange(AGE,desc(ID))
    ```

    

